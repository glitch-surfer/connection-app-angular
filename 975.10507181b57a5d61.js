"use strict";(self.webpackChunkconnection=self.webpackChunkconnection||[]).push([[975],{5975:(nt,C,o)=>{o.r(C),o.d(C,{GroupDialogComponent:()=>W});var g=o(6223),p=o(6814),d=o(2072),x=o(5619),O=o(5940),t=o(9212),c=o(7398),_=o(2572),D=o(1687),l=o(9397),h=o(6306),m=o(6232),f=o(4716),$=o(2181),S=o(4664),A=o(418),b=o(1831),P=o(4202);const y=n=>n.dialogs;var Z=o(5295),G=o(228),u=o(192),L=o(4587),T=o(3753),E=o(3463),U=o(4433),F=o(2169),J=o(8833),N=o(8168),k=o(3096),R=o(7700);let w=(()=>{class n{constructor(e,s,i,v,V,q,tt){this.groupsHttpService=e,this.store=s,this.notificationService=i,this.router=v,this.peopleListService=V,this.groupsListService=q,this.dialog=tt,this.since={},this.messagesRaw$=this.store.select(y).pipe((0,c.U)(a=>a[this.groupId]?a[this.groupId].messages:[])),this.peoples$=this.store.select(E.U),this.loading$$=new x.X(!1),this.loading$=this.loading$$.asObservable(),this.groupId="",this.groupAuthorId$=this.store.select(G.G).pipe((0,c.U)(a=>a.find(M=>M.id===this.groupId)?.createdBy)),this.userId$=this.store.select(Z.t).pipe((0,c.U)(a=>a.uid)),this.messages$=(0,_.a)([this.messagesRaw$,this.peoples$]).pipe((0,c.U)(([a,M])=>a.map(I=>({...I,author:M.find(et=>et.uid===I.authorID)?.name??"Me"})))),this.timers={}}initDialog(){this.groupsListService.initGroupsList(),this.peopleListService.initPeoplesList(),this.getMessages()}setTimer(){const e=this.timers[this.groupId];if(e.getValue())return;let s=b.l;const i=(0,D.F)(b.W).subscribe(()=>{0!==s?(s-=1,e.next(s)):i.unsubscribe()})}getMessages(){this.loading$$.next(!0),this.groupsHttpService.getMessages(this.groupId,this.since[this.groupId]??"").pipe((0,c.U)(e=>(0,A.r)(e)),(0,c.U)(e=>e.sort((s,i)=>+s.createdAt-+i.createdAt).slice()),(0,l.b)(e=>{const s=!this.since[this.groupId];e.length>0&&(this.since[this.groupId]=e[e.length-1].createdAt),this.store.dispatch(s?(0,P.w)({groupId:this.groupId,messages:e}):(0,P.C)({groupId:this.groupId,messages:e}))}),(0,h.K)(()=>(this.notificationService.error(u.T.ERROR_LOAD_MESSAGES),m.E)),(0,f.x)(()=>this.loading$$.next(!1))).subscribe()}deleteGroup(){this.dialog.open(T.S,{data:{title:"Delete group",content:"Are you sure you want to delete this group?",confirmButtonText:"Delete"}}).afterClosed().pipe((0,$.h)(Boolean),(0,l.b)(()=>this.loading$$.next(!0)),(0,S.w)(()=>this.groupsHttpService.deleteGroup(this.groupId)),(0,l.b)(()=>this.store.dispatch((0,L.II)({id:this.groupId}))),(0,l.b)(()=>this.notificationService.success(u.T.SUCCESS_DELETED_GROUP)),(0,l.b)(()=>this.router.navigate(["/"])),(0,h.K)(()=>(this.notificationService.error(u.T.ERROR_DELETED_GROUP),m.E)),(0,f.x)(()=>this.loading$$.next(!1))).subscribe()}sendMessage(e){this.loading$$.next(!0),this.groupsHttpService.sendMessage(this.groupId,e).pipe((0,l.b)(()=>this.getMessages()),(0,h.K)(()=>(this.notificationService.error(u.T.ERROR_SEND_MESSAGE),m.E)),(0,f.x)(()=>this.loading$$.next(!1))).subscribe()}static#t=this.\u0275fac=function(s){return new(s||n)(t.LFG(U.k),t.LFG(F.yh),t.LFG(J.g),t.LFG(d.F0),t.LFG(N.B),t.LFG(k.n),t.LFG(R.uw))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function z(n,r){1&n&&t._UZ(0,"mat-spinner",3)}function Q(n,r){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"async"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" (timeout: ",t.lcZ(2,1,e.timer$),")")}}function Y(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.onDeleteGroup())}),t.ALo(1,"async"),t._uU(2," Delete "),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("disabled",t.lcZ(1,1,e.loading$))}}function H(n,r){if(1&n&&(t.TgZ(0,"li",14),t.ALo(1,"async"),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"date"),t.qZA(),t._uU(5),t.qZA()),2&n){const e=r.$implicit,s=t.oxw(3);t.ekj("user-messages",t.lcZ(1,5,s.userId$)===e.authorID),t.xp6(3),t.hij("(",t.lcZ(4,7,e.createdAt),")"),t.xp6(2),t.AsE(" ",e.author,": ",e.message," ")}}function B(n,r){1&n&&(t.TgZ(0,"li"),t._uU(1,"No messages yet"),t.qZA())}function j(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.onUpdateMessages())}),t.ALo(3,"async"),t.ALo(4,"async"),t._uU(5," Update"),t.YNc(6,Q,3,3,"span",8),t.ALo(7,"async"),t.qZA(),t.YNc(8,Y,3,3,"button",9),t.ALo(9,"async"),t.ALo(10,"async"),t.qZA(),t.TgZ(11,"ul",10),t.YNc(12,H,6,9,"li",11),t.ALo(13,"async"),t.YNc(14,B,2,0,"li",8),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"div",12),t._UZ(17,"input",13),t.TgZ(18,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.onSendMessage())}),t.ALo(19,"async"),t._uU(20," Send "),t.qZA()(),t.BQk()}if(2&n){const e=t.oxw(2);let s;t.xp6(2),t.Q6J("disabled",t.lcZ(3,7,e.timer$)||t.lcZ(4,9,e.loading$)),t.xp6(4),t.Q6J("ngIf",t.lcZ(7,11,e.timer$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(9,13,e.userId$)===t.lcZ(10,15,e.groupAuthorId$)),t.xp6(4),t.Q6J("ngForOf",t.lcZ(13,17,e.messages$)),t.xp6(2),t.Q6J("ngIf",!(null!=(s=t.lcZ(15,19,e.messages$))&&s.length)),t.xp6(3),t.Q6J("formControl",e.newMessage),t.xp6(1),t.Q6J("disabled",t.lcZ(19,21,e.loading$)||e.newMessage.invalid)}}function K(n,r){1&n&&(t.TgZ(0,"p",15),t._uU(1,"Gruop doesn't exist"),t.qZA())}function X(n,r){if(1&n&&(t.YNc(0,j,21,23,"ng-container",4),t.ALo(1,"async"),t.YNc(2,K,2,0,"ng-template",null,5,t.W1O)),2&n){const e=t.MAs(3),s=t.oxw();t.Q6J("ngIf",!!t.lcZ(1,2,s.groupAuthorId$))("ngIfElse",e)}}let W=(()=>{class n{constructor(e,s){this.groupDialogService=e,this.router=s,this.newMessage=new g.NI("",{validators:[g.kI.required]}),this.loading$=this.groupDialogService.loading$,this.messages$=this.groupDialogService.messages$,this.groupAuthorId$=this.groupDialogService.groupAuthorId$,this.userId$=this.groupDialogService.userId$}ngOnInit(){this.groupDialogService.groupId=this.router.snapshot.params.id,this.groupDialogService.timers[this.groupDialogService.groupId]||(this.groupDialogService.timers[this.groupDialogService.groupId]=new x.X(0)),this.timer$=this.groupDialogService.timers[this.groupDialogService.groupId],this.groupDialogService.initDialog()}onUpdateMessages(){this.groupDialogService.setTimer(),this.groupDialogService.getMessages()}onDeleteGroup(){this.groupDialogService.deleteGroup()}onSendMessage(){this.newMessage.invalid||!this.newMessage.value||(this.groupDialogService.sendMessage(this.newMessage.value),this.newMessage.setValue(""))}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(w),t.Y36(d.gz))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-group-dialog"]],standalone:!0,features:[t.jDz],decls:6,vars:4,consts:[["routerLink","/",1,"back-link"],["class","spinner",4,"ngIf","ngIfElse"],["content",""],[1,"spinner"],[4,"ngIf","ngIfElse"],["notExist",""],[1,"btn-wrapper"],[1,"btn",3,"disabled","click"],[4,"ngIf"],["class","btn",3,"disabled","click",4,"ngIf"],[1,"messages"],["class","messages__item",3,"user-messages",4,"ngFor","ngForOf"],[1,"input-wrapper"],["type","text","placeholder","Message",1,"input",3,"formControl"],[1,"messages__item"],[1,"error-title"]],template:function(s,i){if(1&s&&(t.TgZ(0,"a",0),t._uU(1,"Back"),t.qZA(),t.YNc(2,z,1,0,"mat-spinner",1),t.ALo(3,"async"),t.YNc(4,X,4,4,"ng-template",null,2,t.W1O)),2&s){const v=t.MAs(5);t.xp6(2),t.Q6J("ngIf",t.lcZ(3,2,i.loading$))("ngIfElse",v)}},dependencies:[p.ez,p.sg,p.O5,p.Ov,p.uU,d.Bz,d.rH,g.UX,g.Fj,g.JJ,g.oH,O.Cq,O.Ou],styles:["*[_ngcontent-%COMP%]{box-sizing:border-box;margin:0;padding:0}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%}body[_ngcontent-%COMP%]{background-color:#e3f2fd;font-family:Roboto,Helvetica Neue,sans-serif}body.dark-theme[_ngcontent-%COMP%]{background-color:#283593;color:#e3f2fd}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited{color:#3f51b5}a[_ngcontent-%COMP%]:hover, a[_ngcontent-%COMP%]:visited:hover{opacity:.8}a[_ngcontent-%COMP%]:active, a[_ngcontent-%COMP%]:visited:active{opacity:.6}.dark-theme[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#e89126}.error-snackbar[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;color:#3f51b5;background-color:#e3f2fd;border-bottom:3px solid #ff0000}.success-snackbar[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;color:#3f51b5;background-color:#e3f2fd;border-bottom:3px solid #00ff00}button[_ngcontent-%COMP%]:disabled{color:#757575}.btn[_ngcontent-%COMP%]{height:36px;padding:0 1rem;align-self:flex-start;color:#fafafa;background-color:#424242;border-radius:4px;border:none;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{opacity:.9}.btn[_ngcontent-%COMP%]:disabled{background-color:#b8b1b1;opacity:1;cursor:not-allowed}.input[_ngcontent-%COMP%]{width:100%;padding:0 .5rem;background-color:transparent;border:1px solid #3f51b5;border-radius:4px}.messages[_ngcontent-%COMP%]{max-height:50vh;display:flex;flex-direction:column;gap:.25rem;padding:.5rem;border:1px solid #283593;border-radius:4px;list-style:none;overflow:auto}.messages__item[_ngcontent-%COMP%]{margin-right:2rem;padding:.5rem;width:-moz-fit-content;width:fit-content;display:flex;flex-direction:column;gap:.25rem;border:1px solid #3f51b5;border-radius:4px;background-color:#9cd1f8}.user-messages[_ngcontent-%COMP%]{margin-right:0;margin-left:2rem;align-self:flex-end}.spinner[_ngcontent-%COMP%]{margin-top:1rem;align-self:center}[_nghost-%COMP%]{max-width:800px;margin:0 auto;padding:1rem;display:flex;flex-direction:column;gap:1rem}.btn-wrapper[_ngcontent-%COMP%]{display:flex;gap:1rem}.input-wrapper[_ngcontent-%COMP%]{display:flex;gap:.5rem}.error-title[_ngcontent-%COMP%]{margin-top:3rem;font-size:2rem;text-align:center}.dark-theme[_nghost-%COMP%]   a[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   a[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   a[_ngcontent-%COMP%]:visited, .dark-theme   [_nghost-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#e89126}.dark-theme[_nghost-%COMP%]   .input[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .input[_ngcontent-%COMP%]{color:#e3f2fd;border-color:#e89126}.dark-theme[_nghost-%COMP%]   .messages[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .messages[_ngcontent-%COMP%]{border-color:#e89126}.dark-theme[_nghost-%COMP%]   .messages__item[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .messages__item[_ngcontent-%COMP%]{border-color:#e89126;background-color:#af6913}"]})}return n})()}}]);
import{a as l}from"./chunk-5JDCOLZI.js";import{a as P}from"./chunk-QKVZ2CT4.js";import{b as R}from"./chunk-GSZV43AH.js";import{y as n,z as O}from"./chunk-2SKVBX5T.js";import{Cb as N,Gb as a,H as e,Hb as f,L as h,O as s,a as S,b as g,f as $,h as d,k as b,l as v,v as c,vb as E,z as p}from"./chunk-5IAL5MBJ.js";var j=({name:o,email:t,uid:x,createdAt:i})=>({name:o.S,email:t.S,uid:x.S,createdAt:i.S});var I=(()=>{let t=class t{constructor(i){this.http=i}getProfile(){return this.http.get(`${a.BASE_URL}${a.PROFILE}`)}updateProfileName(i){return this.http.put(`${a.BASE_URL}${a.PROFILE}`,{name:i})}};t.\u0275fac=function(r){return new(r||t)(s(E))},t.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var H=(()=>{let t=class t{constructor(i,r,u,m,U){this.http=i,this.store=r,this.notificationService=u,this.authService=m,this.router=U,this.profile=null,this.subscription=[],this.loading$$=new $(!1),this.loading$=this.loading$$.asObservable(),this.profile$=this.store.select(P)}getProfile(){return this.profile?this.profile:(this.loading$$.next(!0),this.http.getProfile().pipe(v(j),e(i=>this.store.dispatch(l({profile:i}))),e(i=>{this.profile=i}),p(()=>this.loading$$.next(!1)),c(i=>(this.notificationService.error(i.error.message||n.UNKNOWN_ERROR),i.error.type==="InvalidIDException"&&this.logout(),d))).subscribe(),null)}updateProfileName(i){this.loading$$.next(!0);let r=g(S({},this.profile),{name:i}),u=this.http.updateProfileName(i).pipe(e(()=>this.store.dispatch(l({profile:r}))),e(()=>{this.profile=r}),e(()=>this.notificationService.success(n.SUCCESS_PROFILE_NAME)),c(m=>(this.notificationService.error(m.error.message||n.UNKNOWN_ERROR),d)),p(()=>this.loading$$.next(!1))).subscribe();this.subscription.push(u)}logout(){this.loading$$.next(!0);let i=this.authService.signOut().pipe(c(r=>(this.notificationService.error(r.error.message||n.UNKNOWN_ERROR),b(null))),e(()=>this.notificationService.success(n.SUCCESS_LOGOUT)),e(()=>this.store.dispatch(l({profile:{uid:""}}))),e(()=>{this.profile=null}),e(()=>this.router.navigate(["/signin"])),e(()=>f.removeCredentials()),p(()=>this.loading$$.next(!1))).subscribe();this.subscription.push(i)}ngOnDestroy(){this.subscription.forEach(i=>i.unsubscribe())}};t.\u0275fac=function(r){return new(r||t)(s(I),s(R),s(O),s(f),s(N))},t.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();export{H as a};
